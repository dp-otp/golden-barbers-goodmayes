<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pay | Golden Barbers</title>
    <meta name="robots" content="noindex, nofollow">
    <meta name="theme-color" content="#000000">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --gold: #d4af37;
            --gold-light: #f5d778;
            --gold-dark: #a88a2d;
            --black: #000000;
            --dark: #0a0a0a;
            --dark-card: #111111;
            --white: #ffffff;
            --gray: #888888;
            --gray-dark: #444444;
            --green: #22c55e;
            --green-dark: #16a34a;
            --red: #ef4444;
        }

        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--black);
            color: var(--white);
            min-height: 100vh;
            min-height: 100dvh;
            overflow-x: hidden;
        }

        .page-wrap {
            max-width: 480px;
            margin: 0 auto;
            padding: 16px 16px 40px;
            animation: fadeUp 0.5s ease;
        }

        @keyframes fadeUp { from { opacity:0; transform:translateY(16px); } to { opacity:1; transform:translateY(0); } }
        @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
        @keyframes scaleIn { from { opacity:0; transform:scale(0.92); } to { opacity:1; transform:scale(1); } }
        @keyframes checkPop { 0% { transform:scale(0); } 60% { transform:scale(1.15); } 100% { transform:scale(1); } }
        @keyframes spin { to { transform:rotate(360deg); } }
        @keyframes dotPulse { 0%,80%,100% { transform:scale(0.6); opacity:0.4; } 40% { transform:scale(1); opacity:1; } }
        @keyframes verifyPulse { 0%,100% { box-shadow: 0 0 0 0 rgba(212,175,55,0.4); } 50% { box-shadow: 0 0 0 12px rgba(212,175,55,0); } }

        /* Header */
        .header { text-align:center; padding:8px 0 20px; }
        .header-logo { width:60px; height:60px; margin:0 auto 10px; border-radius:50%; object-fit:contain; }
        .header h1 { font-size:18px; font-weight:700; }
        .header h1 span { color:var(--gold); }
        .header-sub { color:var(--gray); font-size:12px; margin-top:2px; }

        /* Amount Hero */
        .amount-hero {
            text-align:center;
            padding:24px 20px;
            background: linear-gradient(135deg, rgba(212,175,55,0.1), rgba(212,175,55,0.03));
            border: 1px solid rgba(212,175,55,0.25);
            border-radius:20px;
            margin-bottom:14px;
        }
        .amount-label { font-size:12px; color:var(--gray); text-transform:uppercase; letter-spacing:1.5px; margin-bottom:6px; }
        .amount-value { font-size:52px; font-weight:900; color:var(--gold); line-height:1; margin-bottom:10px; }

        .services-toggle {
            display:inline-flex; align-items:center; gap:5px;
            background:none; border:none; color:var(--gray);
            font-family:'Outfit',sans-serif; font-size:13px; cursor:pointer;
            padding:5px 10px; border-radius:16px; transition:color 0.3s;
        }
        .services-toggle:hover { color:var(--white); }
        .services-toggle svg { width:14px; height:14px; transition:transform 0.3s; }
        .services-toggle.open svg { transform:rotate(180deg); }

        .services-detail { max-height:0; overflow:hidden; transition:max-height 0.4s ease, margin 0.4s ease; }
        .services-detail.open { max-height:400px; margin-top:10px; }
        .services-detail-inner { background:rgba(0,0,0,0.4); border-radius:12px; padding:10px 14px; }
        .service-line { display:flex; justify-content:space-between; padding:5px 0; font-size:13px; }
        .service-line-name { color:rgba(255,255,255,0.8); }
        .service-line-price { color:var(--gold); font-weight:600; }

        /* Card */
        .card {
            background:var(--dark-card);
            border:1px solid rgba(255,255,255,0.07);
            border-radius:20px;
            padding:22px 18px;
            margin-bottom:14px;
        }

        .card-header { display:flex; align-items:center; gap:10px; margin-bottom:18px; }
        .card-icon {
            width:38px; height:38px;
            background:rgba(212,175,55,0.1);
            border-radius:11px;
            display:flex; align-items:center; justify-content:center;
        }
        .card-icon svg { width:18px; height:18px; stroke:var(--gold); fill:none; stroke-width:2; }
        .card-title { font-size:15px; font-weight:700; }
        .card-subtitle { font-size:11px; color:var(--gray); }

        /* Bank Details */
        .bank-detail {
            display:flex; align-items:center; justify-content:space-between;
            padding:12px 0; border-bottom:1px solid rgba(255,255,255,0.05);
        }
        .bank-detail:last-of-type { border-bottom:none; }
        .bank-detail-left { flex:1; min-width:0; }
        .bank-detail-label { font-size:10px; color:var(--gray); text-transform:uppercase; letter-spacing:0.7px; margin-bottom:3px; }
        .bank-detail-value { font-size:16px; font-weight:700; letter-spacing:0.3px; }
        .bank-detail-value.gold { color:var(--gold); }

        .copy-btn {
            padding:7px 14px;
            background:rgba(212,175,55,0.1); border:1px solid rgba(212,175,55,0.2);
            border-radius:10px; color:var(--gold);
            font-family:'Outfit',sans-serif; font-size:12px; font-weight:600;
            cursor:pointer; transition:all 0.2s;
            min-width:62px; text-align:center;
        }
        .copy-btn:active { transform:scale(0.95); }
        .copy-btn.copied { background:var(--green); border-color:var(--green); color:var(--white); }

        .copy-all-btn {
            width:100%; padding:14px; margin-top:14px;
            background:rgba(212,175,55,0.06);
            border:1.5px dashed rgba(212,175,55,0.3);
            border-radius:14px; color:var(--gold);
            font-family:'Outfit',sans-serif; font-size:14px; font-weight:600;
            cursor:pointer; transition:all 0.3s;
            display:flex; align-items:center; justify-content:center; gap:8px;
        }
        .copy-all-btn:hover { background:rgba(212,175,55,0.12); border-color:var(--gold); }
        .copy-all-btn:active { transform:scale(0.98); }
        .copy-all-btn.copied { background:rgba(34,197,94,0.12); border-color:var(--green); border-style:solid; color:var(--green); }
        .copy-all-btn svg { width:16px; height:16px; }

        /* ===== BANK SELECTOR ===== */
        .banks-grid {
            display:grid;
            grid-template-columns: repeat(2, 1fr);
            gap:10px;
        }

        .bank-btn {
            display:flex;
            align-items:center;
            gap:14px;
            padding:16px;
            background:rgba(255,255,255,0.03);
            border:1.5px solid rgba(255,255,255,0.08);
            border-radius:16px;
            cursor:pointer;
            transition:all 0.25s;
            text-decoration:none;
            position:relative;
            overflow:hidden;
        }

        .bank-btn:active { transform:scale(0.96); background:rgba(255,255,255,0.07); }
        .bank-btn:hover { border-color:rgba(255,255,255,0.18); background:rgba(255,255,255,0.05); }

        .bank-btn-logo {
            width:42px; height:42px;
            border-radius:12px;
            display:flex; align-items:center; justify-content:center;
            flex-shrink:0;
            overflow:hidden;
            background:#1a1a1a;
        }

        .bank-btn-logo img {
            width:32px; height:32px;
            border-radius:8px;
            object-fit:contain;
        }

        .bank-btn-logo svg {
            width:24px; height:24px;
        }

        .bank-btn-text {
            flex:1; min-width:0;
        }

        .bank-btn-name {
            font-size:14px;
            font-weight:600;
            color:var(--white);
            line-height:1.2;
        }

        .bank-btn-type {
            font-size:11px;
            color:var(--gray);
            margin-top:2px;
        }

        .bank-btn-arrow {
            width:16px; height:16px;
            color:var(--gray);
            flex-shrink:0;
            transition:transform 0.2s;
        }

        .bank-btn:hover .bank-btn-arrow { transform:translateX(2px); color:var(--white); }

        /* More banks */
        .more-banks-toggle {
            display:flex; align-items:center; justify-content:center; gap:6px;
            width:100%; padding:12px; margin-top:12px;
            background:none;
            border:1px solid rgba(255,255,255,0.08);
            border-radius:12px; color:var(--gray);
            font-family:'Outfit',sans-serif; font-size:13px;
            cursor:pointer; transition:all 0.3s;
        }
        .more-banks-toggle:hover { color:var(--white); border-color:rgba(255,255,255,0.15); }
        .more-banks-toggle svg { width:14px; height:14px; transition:transform 0.3s; }
        .more-banks-toggle.open svg { transform:rotate(180deg); }

        .more-banks { display:none; margin-top:10px; }
        .more-banks.open { display:grid; grid-template-columns:repeat(2,1fr); gap:10px; animation:fadeIn 0.3s ease; }

        /* Routing toast */
        .routing-toast {
            position:fixed; top:0; left:0; right:0;
            background:linear-gradient(135deg, #111, #1a1a1a);
            border-bottom:1px solid rgba(212,175,55,0.3);
            padding:16px 20px; z-index:1000;
            transform:translateY(-100%);
            transition:transform 0.4s cubic-bezier(0.175,0.885,0.32,1.275);
            display:flex; align-items:center; gap:12px;
        }
        .routing-toast.show { transform:translateY(0); }
        .routing-toast-logo { width:36px; height:36px; border-radius:10px; flex-shrink:0; display:flex; align-items:center; justify-content:center; }
        .routing-toast-logo img { width:100%; height:100%; object-fit:contain; padding:4px; }
        .routing-toast-text { flex:1; }
        .routing-toast-title { font-size:14px; font-weight:700; }
        .routing-toast-sub { font-size:12px; color:var(--green); }
        .routing-toast-loader { width:22px; height:22px; border:2px solid rgba(212,175,55,0.2); border-top-color:var(--gold); border-radius:50%; animation:spin 0.8s linear infinite; }

        /* ===== VERIFICATION FLOW ===== */
        .verify-overlay {
            display:none;
            position:fixed; top:0; left:0; right:0; bottom:0;
            background:rgba(0,0,0,0.92);
            z-index:2000;
            align-items:center; justify-content:center;
            padding:20px;
        }
        .verify-overlay.show { display:flex; }

        .verify-card {
            width:100%; max-width:400px;
            background:var(--dark-card);
            border:1px solid rgba(212,175,55,0.2);
            border-radius:24px;
            padding:30px 24px;
            text-align:center;
            animation:scaleIn 0.4s ease;
        }

        .verify-icon {
            width:60px; height:60px;
            background:rgba(212,175,55,0.1);
            border:2px solid rgba(212,175,55,0.3);
            border-radius:50%;
            display:flex; align-items:center; justify-content:center;
            margin:0 auto 18px;
            animation:verifyPulse 2s ease infinite;
        }
        .verify-icon svg { width:28px; height:28px; stroke:var(--gold); fill:none; stroke-width:2; }

        .verify-title { font-size:20px; font-weight:800; margin-bottom:6px; }
        .verify-sub { font-size:13px; color:var(--gray); margin-bottom:24px; line-height:1.5; }

        .verify-input-wrap { margin-bottom:20px; }

        .verify-label { font-size:11px; color:var(--gray); text-transform:uppercase; letter-spacing:0.7px; margin-bottom:8px; text-align:left; }

        .verify-input {
            width:100%; padding:16px;
            background:rgba(0,0,0,0.4);
            border:1.5px solid rgba(255,255,255,0.12);
            border-radius:14px;
            color:var(--white);
            font-family:'Outfit',sans-serif;
            font-size:18px; font-weight:600;
            text-align:center;
            letter-spacing:2px;
            outline:none;
            transition:border-color 0.3s;
        }
        .verify-input:focus { border-color:var(--gold); }
        .verify-input::placeholder { color:var(--gray-dark); font-weight:400; letter-spacing:0; font-size:14px; }

        .verify-error {
            font-size:12px; color:var(--red);
            margin-top:8px; min-height:18px;
            text-align:left;
        }

        .verify-hint {
            font-size:12px; color:var(--gray);
            margin-bottom:20px; line-height:1.5;
            background:rgba(255,255,255,0.03);
            border-radius:10px;
            padding:12px;
            text-align:left;
        }
        .verify-hint strong { color:rgba(255,255,255,0.7); }

        .verify-submit {
            width:100%; padding:16px;
            background:linear-gradient(135deg, var(--gold), var(--gold-dark));
            color:var(--black); border:none; border-radius:14px;
            font-family:'Outfit',sans-serif;
            font-size:16px; font-weight:700;
            cursor:pointer; transition:all 0.3s;
            display:flex; align-items:center; justify-content:center; gap:8px;
        }
        .verify-submit:hover { transform:translateY(-2px); box-shadow:0 8px 25px rgba(212,175,55,0.3); }
        .verify-submit:active { transform:scale(0.98); }
        .verify-submit:disabled { opacity:0.5; cursor:not-allowed; transform:none; }
        .verify-submit svg { width:18px; height:18px; }
        .verify-submit .spinner { width:18px; height:18px; border:2px solid transparent; border-top-color:var(--black); border-radius:50%; animation:spin 0.8s linear infinite; display:none; }
        .verify-submit.loading .spinner { display:block; }
        .verify-submit.loading .btn-label { display:none; }

        .verify-cancel {
            margin-top:14px;
            background:none; border:none;
            color:var(--gray); font-family:'Outfit',sans-serif;
            font-size:13px; cursor:pointer;
            padding:8px 16px;
            transition:color 0.2s;
        }
        .verify-cancel:hover { color:var(--white); }

        /* Confirm button */
        .confirm-section { margin-bottom:14px; }

        .confirm-btn {
            width:100%; padding:18px;
            background:linear-gradient(135deg, var(--green), var(--green-dark));
            color:var(--white); border:none; border-radius:16px;
            font-size:17px; font-weight:700;
            font-family:'Outfit',sans-serif;
            cursor:pointer; transition:all 0.3s;
            display:flex; align-items:center; justify-content:center; gap:10px;
            box-shadow:0 6px 25px rgba(34,197,94,0.3);
        }
        .confirm-btn:hover { transform:translateY(-2px); box-shadow:0 10px 35px rgba(34,197,94,0.4); }
        .confirm-btn:active { transform:scale(0.98); }
        .confirm-btn svg { width:20px; height:20px; }
        .confirm-note { text-align:center; font-size:11px; color:var(--gray); margin-top:8px; }

        /* Success */
        .success-screen { display:none; text-align:center; padding:40px 20px; animation:scaleIn 0.5s ease; }
        .success-screen.show { display:block; }

        .success-circle {
            width:90px; height:90px;
            background:rgba(34,197,94,0.12); border:3px solid var(--green);
            border-radius:50%; display:flex; align-items:center; justify-content:center;
            margin:0 auto 20px; animation:checkPop 0.6s ease;
        }
        .success-circle svg { width:44px; height:44px; stroke:var(--green); stroke-width:3; fill:none; }

        .success-screen h2 { font-size:24px; font-weight:800; margin-bottom:6px; }
        .success-screen .success-sub { color:var(--gray); font-size:14px; margin-bottom:20px; }
        .success-amount { font-size:42px; font-weight:900; color:var(--gold); margin-bottom:6px; }
        .success-ref { font-size:13px; color:var(--gray); margin-bottom:28px; }
        .success-ref span { color:var(--white); font-weight:600; font-family:monospace; }

        .success-badge {
            display:inline-flex; align-items:center; gap:8px;
            padding:12px 24px;
            background:rgba(34,197,94,0.1); border:1px solid rgba(34,197,94,0.3);
            border-radius:50px; color:var(--green); font-size:14px; font-weight:600;
        }
        .success-badge svg { width:16px; height:16px; }

        .success-show-staff {
            margin-top:24px; padding:16px;
            background:rgba(212,175,55,0.08); border:1px solid rgba(212,175,55,0.2);
            border-radius:14px; font-size:14px; color:var(--gold); font-weight:600;
        }

        .success-verify-code {
            margin-top:16px; padding:14px;
            background:rgba(255,255,255,0.04);
            border-radius:12px;
        }
        .success-verify-label { font-size:11px; color:var(--gray); text-transform:uppercase; letter-spacing:0.7px; margin-bottom:6px; }
        .success-verify-value { font-size:28px; font-weight:900; letter-spacing:6px; color:var(--white); font-family:monospace; }

        /* Error */
        .error-screen { display:none; text-align:center; padding:50px 20px; }
        .error-screen.show { display:block; }
        .error-icon { font-size:48px; margin-bottom:16px; }
        .error-screen h2 { font-size:20px; margin-bottom:8px; }
        .error-screen p { color:var(--gray); font-size:14px; }

        /* Loading */
        .loading-screen { text-align:center; padding:60px 20px; }
        .loading-dots { display:flex; align-items:center; justify-content:center; gap:8px; margin-bottom:16px; }
        .loading-dot { width:10px; height:10px; background:var(--gold); border-radius:50%; animation:dotPulse 1.4s ease infinite; }
        .loading-dot:nth-child(2) { animation-delay:0.2s; }
        .loading-dot:nth-child(3) { animation-delay:0.4s; }
        .loading-screen p { color:var(--gray); font-size:14px; }

        .payment-content { display:none; }
        .payment-content.show { display:block; }

        /* Footer */
        .footer { text-align:center; padding:16px 0 8px; font-size:11px; color:var(--gray); }
        .footer a { color:var(--gold); text-decoration:none; }
        .secure-line { display:flex; align-items:center; justify-content:center; gap:5px; margin-bottom:4px; }
        .secure-line svg { width:12px; height:12px; stroke:var(--gray); fill:none; stroke-width:2; }

        /* Toast */
        .toast {
            position:fixed; bottom:30px; left:50%;
            transform:translateX(-50%) translateY(80px);
            background:var(--dark-card); border:1px solid rgba(34,197,94,0.3);
            color:var(--white); padding:12px 20px; border-radius:50px;
            font-size:13px; font-weight:600; font-family:'Outfit',sans-serif;
            box-shadow:0 10px 40px rgba(0,0,0,0.6); z-index:999;
            transition:transform 0.4s cubic-bezier(0.175,0.885,0.32,1.275);
            display:flex; align-items:center; gap:8px;
        }
        .toast.show { transform:translateX(-50%) translateY(0); }
        .toast svg { width:16px; height:16px; stroke:var(--green); }

        /* Discount Code */
        .discount-section { margin-bottom:14px; }
        .discount-input-row {
            display:flex; gap:8px;
        }
        .discount-input {
            flex:1; padding:14px 16px;
            background:rgba(0,0,0,0.4);
            border:1.5px solid rgba(255,255,255,0.1);
            border-radius:14px;
            color:var(--white);
            font-family:'Outfit',sans-serif;
            font-size:15px; font-weight:600;
            text-transform:uppercase;
            letter-spacing:1px;
            outline:none;
            transition:border-color 0.3s;
        }
        .discount-input:focus { border-color:var(--gold); }
        .discount-input::placeholder { color:var(--gray-dark); font-weight:400; text-transform:none; letter-spacing:0; font-size:13px; }
        .discount-apply-btn {
            padding:14px 20px;
            background:linear-gradient(135deg, var(--gold), var(--gold-dark));
            color:var(--black); border:none; border-radius:14px;
            font-family:'Outfit',sans-serif;
            font-size:14px; font-weight:700;
            cursor:pointer; transition:all 0.2s;
            white-space:nowrap;
        }
        .discount-apply-btn:active { transform:scale(0.96); }
        .discount-apply-btn:disabled { opacity:0.5; cursor:not-allowed; }
        .discount-result {
            margin-top:10px; padding:12px 16px;
            border-radius:12px; font-size:13px; font-weight:600;
            display:none;
        }
        .discount-result.success {
            display:flex; align-items:center; justify-content:space-between;
            background:rgba(34,197,94,0.1); border:1px solid rgba(34,197,94,0.3); color:var(--green);
        }
        .discount-result.error {
            display:block;
            background:rgba(239,68,68,0.1); border:1px solid rgba(239,68,68,0.3); color:var(--red);
        }
        .discount-remove {
            background:none; border:none; color:var(--red);
            font-family:'Outfit',sans-serif; font-size:12px; font-weight:600;
            cursor:pointer; padding:4px 8px;
        }
        /* discount-banner removed â€“ codes only shown on main site, not pay page */

        /* Savings line in amount hero */
        .savings-line {
            display:inline-block;
            margin-top:6px; padding:4px 12px;
            background:rgba(34,197,94,0.12);
            border:1px solid rgba(34,197,94,0.3);
            border-radius:20px;
            font-size:12px; font-weight:600;
            color:var(--green);
        }
        .original-price {
            text-decoration:line-through;
            color:var(--gray);
            font-size:28px;
            font-weight:600;
            margin-bottom:4px;
        }

        /* ===== PAYMENT HELPER PANEL ===== */
        .pay-helper {
            position:fixed; bottom:0; left:0; right:0;
            background:linear-gradient(to top, #0d0d0d 70%, rgba(13,13,13,0.97));
            border-top:1px solid rgba(212,175,55,0.3);
            z-index:1500;
            transform:translateY(100%);
            transition:transform 0.4s cubic-bezier(0.175,0.885,0.32,1.275);
            padding:0 16px 16px;
            max-height:70vh;
            overflow-y:auto;
        }
        .pay-helper.show { transform:translateY(0); }

        .pay-helper-handle {
            display:flex; align-items:center; justify-content:center;
            padding:10px 0 6px; cursor:pointer;
        }
        .pay-helper-handle span {
            width:36px; height:4px; background:rgba(255,255,255,0.2);
            border-radius:2px; display:block;
        }

        .pay-helper-title {
            display:flex; align-items:center; justify-content:space-between;
            margin-bottom:12px;
        }
        .pay-helper-title h3 { font-size:14px; font-weight:700; color:var(--gold); }
        .pay-helper-close {
            background:none; border:none; color:var(--gray); cursor:pointer;
            font-size:20px; padding:4px 8px; line-height:1;
        }

        .pay-step {
            display:flex; align-items:center; gap:10px;
            padding:10px 12px; margin-bottom:6px;
            background:rgba(255,255,255,0.03);
            border:1px solid rgba(255,255,255,0.06);
            border-radius:12px; transition:all 0.3s;
        }
        .pay-step.active { border-color:rgba(212,175,55,0.4); background:rgba(212,175,55,0.06); }
        .pay-step.done { border-color:rgba(34,197,94,0.3); background:rgba(34,197,94,0.04); }

        .pay-step-num {
            width:24px; height:24px; border-radius:50%;
            background:rgba(255,255,255,0.08);
            display:flex; align-items:center; justify-content:center;
            font-size:11px; font-weight:700; color:var(--gray);
            flex-shrink:0; transition:all 0.3s;
        }
        .pay-step.active .pay-step-num { background:rgba(212,175,55,0.2); color:var(--gold); }
        .pay-step.done .pay-step-num { background:rgba(34,197,94,0.2); color:var(--green); }

        .pay-step-info { flex:1; min-width:0; }
        .pay-step-label { font-size:10px; color:var(--gray); text-transform:uppercase; letter-spacing:0.5px; }
        .pay-step-value { font-size:15px; font-weight:700; color:var(--white); margin-top:1px; }

        .pay-step-copy {
            padding:6px 14px;
            background:rgba(212,175,55,0.12); border:1px solid rgba(212,175,55,0.25);
            border-radius:8px; color:var(--gold);
            font-family:'Outfit',sans-serif; font-size:12px; font-weight:600;
            cursor:pointer; transition:all 0.2s;
            min-width:58px; text-align:center; flex-shrink:0;
        }
        .pay-step-copy:active { transform:scale(0.94); }
        .pay-step-copy.copied { background:var(--green); border-color:var(--green); color:var(--white); }

        .pay-helper-hint {
            text-align:center; font-size:11px; color:var(--gray);
            margin-top:6px; padding:6px 0;
        }

        @media (max-width: 440px) {
            .amount-value { font-size:42px; }
            .banks-grid { grid-template-columns: 1fr; }
            .more-banks.open { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="page-wrap">
        <div class="header">
            <img src="../logo-removebg-preview.png" alt="Golden Barbers" class="header-logo" onerror="this.style.display='none'">
            <h1><span>Golden</span> Barbers</h1>
            <div class="header-sub">Goodmayes, Ilford</div>
        </div>

        <div id="loadingScreen" class="loading-screen">
            <div class="loading-dots"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div>
            <p>Loading your order...</p>
        </div>

        <div id="paymentContent" class="payment-content">
            <!-- Amount -->
            <div class="amount-hero">
                <div class="amount-label">Amount Due</div>
                <div class="original-price" id="originalPrice" style="display:none;"></div>
                <div class="amount-value" id="totalAmount">&pound;0.00</div>
                <div class="savings-line" id="savingsLine" style="display:none;"></div>
                <button class="services-toggle" id="servicesToggle" onclick="toggleServices()">
                    <span id="servicesSummary">1 service</span>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M6 9l6 6 6-6"/></svg>
                </button>
                <div class="services-detail" id="servicesDetail">
                    <div class="services-detail-inner" id="servicesDetailInner"></div>
                </div>
            </div>

            <!-- Discount Code -->
            <div class="card discount-section">
                <div class="card-header">
                    <div class="card-icon"><svg viewBox="0 0 24 24"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83 0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg></div>
                    <div><div class="card-title">Discount Code</div><div class="card-subtitle">Got a code? Apply it here</div></div>
                </div>
                <div class="discount-input-row">
                    <input type="text" class="discount-input" id="discountInput" placeholder="Enter discount code" maxlength="20">
                    <button class="discount-apply-btn" id="discountApplyBtn" onclick="applyDiscountCode()">Apply</button>
                </div>
                <div class="discount-result" id="discountResult"></div>
            </div>

            <!-- Bank Details -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon"><svg viewBox="0 0 24 24"><path d="M3 21h18M3 10h18M5 6l7-3 7 3M4 10v11M20 10v11M8 14v3M12 14v3M16 14v3"/></svg></div>
                    <div><div class="card-title">Payment Details</div><div class="card-subtitle">Send to this account</div></div>
                </div>
                <div class="bank-detail">
                    <div class="bank-detail-left"><div class="bank-detail-label">Account Name</div><div class="bank-detail-value">GOLDEN BARBERS LTD</div></div>
                </div>
                <div class="bank-detail">
                    <div class="bank-detail-left"><div class="bank-detail-label">Sort Code</div><div class="bank-detail-value">30-98-97</div></div>
                    <button class="copy-btn" onclick="copyText('309897',this)">Copy</button>
                </div>
                <div class="bank-detail">
                    <div class="bank-detail-left"><div class="bank-detail-label">Account Number</div><div class="bank-detail-value">58413368</div></div>
                    <button class="copy-btn" onclick="copyText('58413368',this)">Copy</button>
                </div>
                <div class="bank-detail">
                    <div class="bank-detail-left"><div class="bank-detail-label">Amount</div><div class="bank-detail-value gold" id="bankAmount">&pound;0.00</div></div>
                    <button class="copy-btn" onclick="copyAmount(this)">Copy</button>
                </div>
                <div class="bank-detail">
                    <div class="bank-detail-left"><div class="bank-detail-label">Reference</div><div class="bank-detail-value" id="bankRef">-</div></div>
                    <button class="copy-btn" onclick="copyRef(this)">Copy</button>
                </div>
                <button class="copy-all-btn" id="copyAllBtn" onclick="copyAll(this)">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                    Copy All Details
                </button>
            </div>

            <!-- Banks -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon"><svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5M2 12l10 5 10-5"/></svg></div>
                    <div><div class="card-title">Open Your Bank</div><div class="card-subtitle">Details auto-copied when you tap</div></div>
                </div>

                <div class="banks-grid" id="mainBanks"></div>

                <button class="more-banks-toggle" id="moreBanksToggle" onclick="toggleMoreBanks()">
                    <span id="moreBanksText">Show more banks</span>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M6 9l6 6 6-6"/></svg>
                </button>

                <div class="more-banks" id="moreBanks"></div>
            </div>

            <!-- Confirm -->
            <div class="confirm-section">
                <button class="confirm-btn" onclick="startVerification()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 12l2 2 4-4"/><circle cx="12" cy="12" r="10"/></svg>
                    Verify Payment
                </button>
                <div class="confirm-note">You'll need your bank's payment reference to confirm</div>
            </div>

            <div class="footer">
                <div class="secure-line">
                    <svg viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
                    Secure bank transfer &middot; No card needed
                </div>
                <p>Questions? Call <a href="tel:02085989920">020 8598 9920</a></p>
            </div>
        </div>

        <!-- Success -->
        <div id="successScreen" class="success-screen">
            <div class="success-circle"><svg viewBox="0 0 24 24"><path d="M20 6L9 17l-5-5"/></svg></div>
            <h2>Payment Verified!</h2>
            <p class="success-sub">Thank you for your payment</p>
            <div class="success-amount" id="successAmount">&pound;0.00</div>
            <div class="success-ref">Ref: <span id="successRef">-</span></div>
            <div class="success-badge">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg>
                Verified
            </div>
            <div class="success-verify-code">
                <div class="success-verify-label">Verification Code</div>
                <div class="success-verify-value" id="successCode">-</div>
            </div>
            <div class="success-show-staff">Show this screen to your barber</div>
        </div>

        <!-- Error -->
        <div id="errorScreen" class="error-screen">
            <div class="error-icon">&#9888;&#65039;</div>
            <h2>Invalid Payment Link</h2>
            <p>This link has expired or is invalid.<br>Ask your barber to generate a new QR code.</p>
        </div>
    </div>

    <!-- Verification Overlay -->
    <div class="verify-overlay" id="verifyOverlay">
        <div class="verify-card">
            <div class="verify-icon">
                <svg viewBox="0 0 24 24"><path d="M9 12l2 2 4-4"/><rect x="3" y="3" width="18" height="18" rx="3"/></svg>
            </div>
            <div class="verify-title">Confirm Payment</div>
            <div class="verify-sub">Enter the payment reference or confirmation code from your banking app to verify.</div>

            <div class="verify-input-wrap">
                <div class="verify-label">Bank payment reference</div>
                <input type="text" class="verify-input" id="verifyInput" placeholder="e.g. FP-123456789" autocomplete="off" maxlength="30">
                <div class="verify-error" id="verifyError"></div>
            </div>

            <div class="verify-hint">
                <strong>Where to find this:</strong><br>
                Open your banking app &rarr; Recent payments &rarr; Copy the reference or confirmation number shown for this payment.
            </div>

            <button class="verify-submit" id="verifySubmit" onclick="submitVerification()">
                <div class="spinner"></div>
                <span class="btn-label">Verify &amp; Confirm</span>
            </button>

            <button class="verify-cancel" onclick="cancelVerification()">Cancel</button>
        </div>
    </div>

    <!-- Payment Helper Panel -->
    <div class="pay-helper" id="payHelper">
        <div class="pay-helper-handle" onclick="closePayHelper()"><span></span></div>
        <div class="pay-helper-title">
            <h3>Paste these in your bank app</h3>
            <button class="pay-helper-close" onclick="closePayHelper()">&times;</button>
        </div>
        <div id="payHelperSteps"></div>
        <div class="pay-helper-hint">Tap each field to copy, then paste in your banking app</div>
    </div>

    <!-- Routing Toast -->
    <div class="routing-toast" id="routingToast">
        <div class="routing-toast-logo" id="routingToastLogo"></div>
        <div class="routing-toast-text">
            <div class="routing-toast-title" id="routingToastTitle">Opening bank...</div>
            <div class="routing-toast-sub">Payment details copied to clipboard</div>
        </div>
        <div class="routing-toast-loader"></div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <svg viewBox="0 0 24 24" fill="none" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg>
        <span id="toastText">Copied!</span>
    </div>

    <script>
        // ============================================
        // SERVICES
        // ============================================
        var services = {
            'golden-luxury': { name: 'Golden Luxury', price: 45 },
            'golden-bundle': { name: 'Golden Bundle', price: 27 },
            'gents-cut': { name: 'Gents Cut', price: 13.95 },
            'skin-fade': { name: 'Skin Fade', price: 15.95 },
            'head-shave': { name: 'Head Shave', price: 12.95 },
            'children-cut': { name: 'Children Under 12', price: 8.95 },
            'deluxe-hot-towel': { name: 'Deluxe Hot Towel Shave', price: 11 },
            'beard-trim': { name: 'Beard Trim (Machine)', price: 6.95 },
            'turkish-hot-towel': { name: 'Turkish Hot Towel', price: 3 },
            'ear-nose-flaming': { name: 'Ear & Nose Flaming/Waxing', price: 6 },
            'patterns-design': { name: 'Patterns & Design', price: 5 },
            'colour': { name: 'Colour', price: 5 },
            'head-massage': { name: 'Head Massage', price: 5 },
            'mask-treatment': { name: 'Black or Mud Mask', price: 5 }
        };

        var BANK = { name:'GOLDEN BARBERS LTD', sortCode:'30-98-97', sortCodeRaw:'309897', accountNumber:'58413368' };

        // ============================================
        // FIREBASE - live payment logging
        // ============================================
        var firebaseApp = firebase.initializeApp({
            apiKey: "AIzaSyA3eVAdYntGPTsvhAZn0sezj7aYTR9qLC4",
            authDomain: "golden-barbers-e25db.firebaseapp.com",
            databaseURL: "https://golden-barbers-e25db-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "golden-barbers-e25db",
            storageBucket: "golden-barbers-e25db.firebasestorage.app",
            messagingSenderId: "719034478402",
            appId: "1:719034478402:web:d3b3042688795b34e422db"
        });
        var db = firebase.database();

        // ============================================
        // BANK DEFINITIONS - real logos from Google Favicons
        // ============================================
        var BANKS_MAIN = [
            { id:'barclays', name:'Barclays', domain:'barclays.co.uk', ios:'barclays-mobile-banking://', android:'com.barclays.android.barclaysmobilebanking', web:'https://bank.barclays.co.uk' },
            { id:'hsbc', name:'HSBC', domain:'hsbc.co.uk', ios:'hsbcpersonalbanking://', android:'com.hsbc.hsbcukmobilebanking', web:'https://www.hsbc.co.uk' },
            { id:'lloyds', name:'Lloyds', domain:'lloydsbank.com', ios:'lloydsbank://', android:'com.grppl.android.shell.CMBlloydsTSB73', web:'https://www.lloydsbank.com' },
            { id:'natwest', name:'NatWest', domain:'natwest.com', ios:'natwest://', android:'com.natwest.nol', web:'https://www.natwest.com' },
            { id:'monzo', name:'Monzo', domain:'monzo.com', ios:'monzo://', android:'co.uk.getmondo', web:'https://monzo.com' },
            { id:'revolut', name:'Revolut', domain:'revolut.com', ios:'revolut://', android:'com.revolut.revolut', web:'https://www.revolut.com' },
            { id:'starling', name:'Starling', domain:'starlingbank.com', ios:'starlingbank://', android:'com.starlingbank.android', web:'https://www.starlingbank.com' },
            { id:'santander', name:'Santander', domain:'santander.co.uk', ios:'santander://', android:'uk.co.santander.santanderUK', web:'https://www.santander.co.uk' }
        ];

        var BANKS_MORE = [
            { id:'halifax', name:'Halifax', domain:'halifax.co.uk', ios:'halifax://', android:'com.grppl.android.shell.halifax', web:'https://www.halifax.co.uk' },
            { id:'nationwide', name:'Nationwide', domain:'nationwide.co.uk', ios:'nationwide://', android:'co.uk.nationwide.mobile', web:'https://www.nationwide.co.uk' },
            { id:'tsb', name:'TSB', domain:'tsb.co.uk', ios:'tsb://', android:'uk.co.tsb.newmobilebank', web:'https://www.tsb.co.uk' },
            { id:'chase', name:'Chase UK', domain:'chase.co.uk', ios:'chase-uk://', android:'com.chase.intl', web:'https://www.chase.co.uk' },
            { id:'firstdirect', name:'First Direct', domain:'firstdirect.com', ios:'firstdirect://', android:'com.firstdirect.bankingonthego', web:'https://www.firstdirect.com' },
            { id:'virgin', name:'Virgin Money', domain:'virginmoney.com', ios:'virginmoney://', android:'uk.co.virginmoney.hilmobility', web:'https://www.virginmoney.com' },
            { id:'tide', name:'Tide', domain:'tide.co', ios:'tide://', android:'com.tideplatform.banking', web:'https://www.tide.co' },
            { id:'metro', name:'Metro Bank', domain:'metrobankonline.co.uk', ios:'metrobank://', android:'uk.co.metrobankonline.mobile.android.production', web:'https://www.metrobankonline.co.uk' }
        ];

        function getBankLogo(domain) {
            return 'https://www.google.com/s2/favicons?domain=' + domain + '&sz=128';
        }

        var orderTotal = 0;
        var orderItems = [];
        var reference = '';
        var verifyCode = '';
        var appliedDiscount = null;

        // ============================================
        // LOAD LIVE PRICES FROM FIREBASE
        // ============================================
        var pricesLoaded = false;
        db.ref('servicePrices').once('value').then(function(snapshot) {
            var data = snapshot.val();
            if (data) {
                ['haircuts', 'beard', 'addons'].forEach(function(cat) {
                    if (!data[cat]) return;
                    data[cat].forEach(function(fbService) {
                        if (services[fbService.id] && fbService.price !== undefined) {
                            services[fbService.id].price = fbService.price;
                        }
                    });
                });
            }
            pricesLoaded = true;
        }).catch(function() {
            pricesLoaded = true; // continue with hardcoded prices if Firebase fails
        });

        // ============================================
        // INIT
        // ============================================
        function generateReference() {
            var now = new Date();
            return 'GB' + now.getFullYear().toString().slice(-2) + ('0'+(now.getMonth()+1)).slice(-2) + ('0'+now.getDate()).slice(-2) + ('0'+now.getHours()).slice(-2) + ('0'+now.getMinutes()).slice(-2);
        }

        function generateVerifyCode() {
            var chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            var code = '';
            for (var i = 0; i < 6; i++) code += chars.charAt(Math.floor(Math.random() * chars.length));
            return code;
        }

        function getServicesFromUrl() {
            var hash = window.location.hash.substring(1);
            if (hash) return hash;
            var params = new URLSearchParams(window.location.search);
            return params.get('s') || params.get('services') || '';
        }

        function init() {
            reference = generateReference();
            verifyCode = generateVerifyCode();
            var servicesStr = getServicesFromUrl();
            var serviceIds = servicesStr ? servicesStr.split(',') : [];

            serviceIds.forEach(function(id) {
                var service = services[id.trim()];
                if (service) {
                    orderItems.push({ id:id.trim(), name:service.name, price:service.price });
                    orderTotal += service.price;
                }
            });

            if (orderItems.length === 0) {
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('errorScreen').classList.add('show');
                return;
            }

            renderOrder();
            renderBanks();

            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('paymentContent').classList.add('show');
        }

        function renderOrder() {
            var t = '\u00a3' + orderTotal.toFixed(2);
            document.getElementById('totalAmount').textContent = t;
            document.getElementById('servicesSummary').textContent = orderItems.length + ' service' + (orderItems.length > 1 ? 's' : '');
            document.getElementById('servicesDetailInner').innerHTML = orderItems.map(function(i) {
                return '<div class="service-line"><span class="service-line-name">'+i.name+'</span><span class="service-line-price">\u00a3'+i.price.toFixed(2)+'</span></div>';
            }).join('');
            document.getElementById('bankAmount').textContent = t;
            document.getElementById('bankRef').textContent = reference;
        }

        function renderBanks() {
            document.getElementById('mainBanks').innerHTML = BANKS_MAIN.map(bankHtml).join('');
            document.getElementById('moreBanks').innerHTML = BANKS_MORE.map(bankHtml).join('');
        }

        function bankHtml(b) {
            var logoUrl = getBankLogo(b.domain);
            return '<button class="bank-btn" onclick="routeToBank(\''+b.id+'\')">' +
                '<div class="bank-btn-logo">' +
                    '<img src="'+logoUrl+'" alt="'+b.name+'" onerror="this.onerror=null;this.style.display=\'none\';this.parentElement.style.background=\'var(--gray-dark)\';this.parentElement.innerHTML=\'<span style=font-size:16px;font-weight:800;color:white>'+b.name.charAt(0)+'</span>\'">' +
                '</div>' +
                '<div class="bank-btn-text">' +
                    '<div class="bank-btn-name">'+b.name+'</div>' +
                    '<div class="bank-btn-type">Tap to open app</div>' +
                '</div>' +
                '<svg class="bank-btn-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>' +
            '</button>';
        }

        // ============================================
        // BANK ROUTING - copy details & open app
        // ============================================
        var payHelperSteps = [];
        var payHelperVisible = false;

        function safelyCopy(text) {
            return navigator.clipboard.writeText(text).catch(function() {
                var ta = document.createElement('textarea');
                ta.value = text;
                ta.style.cssText = 'position:fixed;left:-9999px;opacity:0;';
                document.body.appendChild(ta);
                ta.focus();
                ta.select();
                document.execCommand('copy');
                document.body.removeChild(ta);
            });
        }

        function buildPayHelperSteps() {
            return [
                { label: 'Sort Code', value: BANK.sortCode, copyValue: BANK.sortCodeRaw, done: false },
                { label: 'Account Number', value: BANK.accountNumber, copyValue: BANK.accountNumber, done: false },
                { label: 'Amount', value: '\u00a3' + orderTotal.toFixed(2), copyValue: orderTotal.toFixed(2), done: false },
                { label: 'Reference', value: reference, copyValue: reference, done: false }
            ];
        }

        function renderPayHelper() {
            var container = document.getElementById('payHelperSteps');
            container.innerHTML = payHelperSteps.map(function(step, i) {
                var cls = step.done ? 'pay-step done' : (i === getNextStep() ? 'pay-step active' : 'pay-step');
                return '<div class="' + cls + '" onclick="copyPayStep(' + i + ')">' +
                    '<div class="pay-step-num">' + (step.done ? '\u2713' : (i + 1)) + '</div>' +
                    '<div class="pay-step-info"><div class="pay-step-label">' + step.label + '</div>' +
                    '<div class="pay-step-value">' + step.value + '</div></div>' +
                    '<button class="pay-step-copy' + (step.done ? ' copied' : '') + '" id="payStepBtn' + i + '">' +
                    (step.done ? 'Copied!' : 'Copy') + '</button></div>';
            }).join('');
        }

        function getNextStep() {
            for (var i = 0; i < payHelperSteps.length; i++) {
                if (!payHelperSteps[i].done) return i;
            }
            return -1;
        }

        function copyPayStep(idx) {
            var step = payHelperSteps[idx];
            safelyCopy(step.copyValue).then(function() {
                step.done = true;
                renderPayHelper();
                showToast(step.label + ' copied');
            });
        }

        function showPayHelper() {
            payHelperSteps = buildPayHelperSteps();
            renderPayHelper();
            document.getElementById('payHelper').classList.add('show');
            payHelperVisible = true;
        }

        function closePayHelper() {
            document.getElementById('payHelper').classList.remove('show');
            payHelperVisible = false;
        }

        function routeToBank(bankId) {
            var bank = BANKS_MAIN.concat(BANKS_MORE).find(function(b){return b.id===bankId;});
            if (!bank) return;

            // Copy sort code first (first field in bank transfer forms)
            safelyCopy(BANK.sortCodeRaw);

            // Show the payment helper panel
            showPayHelper();
            // Mark sort code as copied (first step)
            payHelperSteps[0].done = true;
            renderPayHelper();

            // Show routing toast
            var toast = document.getElementById('routingToast');
            var logoEl = document.getElementById('routingToastLogo');
            logoEl.style.background = '#1a1a1a';
            logoEl.innerHTML = '<img src="'+getBankLogo(bank.domain)+'" alt="'+bank.name+'" style="width:28px;height:28px;border-radius:6px">';
            document.getElementById('routingToastTitle').textContent = 'Opening ' + bank.name + '...';
            toast.classList.add('show');

            showToast('Sort code copied \u2014 paste in your bank app');

            var isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            var isAndroid = /android/i.test(navigator.userAgent);

            if (isIOS && bank.ios) {
                var start = Date.now();
                window.location.href = bank.ios;
                setTimeout(function() {
                    if (Date.now() - start < 2000) window.open(bank.web,'_blank');
                    toast.classList.remove('show');
                }, 1500);
            } else if (isAndroid && bank.android) {
                window.location.href = 'intent://#Intent;package='+bank.android+';end';
                setTimeout(function() { window.open(bank.web,'_blank'); toast.classList.remove('show'); }, 1500);
            } else {
                window.open(bank.web, '_blank');
                setTimeout(function() { toast.classList.remove('show'); }, 2000);
            }
        }

        // When user comes back from banking app, auto-copy next field
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden && payHelperVisible) {
                var next = getNextStep();
                if (next >= 0) {
                    // Small delay to let the page regain focus
                    setTimeout(function() {
                        safelyCopy(payHelperSteps[next].copyValue).then(function() {
                            payHelperSteps[next].done = true;
                            renderPayHelper();
                            showToast(payHelperSteps[next].label + ' copied \u2014 paste it now');
                        });
                    }, 300);
                }
            }
        });

        // ============================================
        // VERIFICATION FLOW
        // ============================================
        function startVerification() {
            document.getElementById('verifyOverlay').classList.add('show');
            document.getElementById('verifyInput').value = '';
            document.getElementById('verifyError').textContent = '';
            setTimeout(function() { document.getElementById('verifyInput').focus(); }, 300);
        }

        function cancelVerification() {
            document.getElementById('verifyOverlay').classList.remove('show');
        }

        function submitVerification() {
            var input = document.getElementById('verifyInput').value.trim();
            var errorEl = document.getElementById('verifyError');
            var btn = document.getElementById('verifySubmit');

            if (input.length < 3) {
                errorEl.textContent = 'Please enter a valid payment reference from your banking app.';
                return;
            }

            errorEl.textContent = '';
            btn.classList.add('loading');
            btn.disabled = true;

            // Log payment to Firebase (REAL - shows in admin panel)
            var subtotal = orderItems.reduce(function(sum, i) { return sum + i.price; }, 0);
            var paymentData = {
                reference: reference,
                verifyCode: verifyCode,
                bankReference: input,
                amount: orderTotal,
                subtotal: subtotal,
                items: orderItems.map(function(i) { return i.name; }),
                itemsDetail: orderItems.map(function(i) { return { name: i.name, price: i.price }; }),
                discount: appliedDiscount ? { code: appliedDiscount.code, type: appliedDiscount.type, value: appliedDiscount.value, saved: (subtotal - orderTotal).toFixed(2) } : null,
                status: 'pending',
                createdAt: new Date().toISOString(),
                date: new Date().toISOString().split('T')[0]
            };

            db.ref('payments').push(paymentData).then(function() {
                btn.classList.remove('loading');
                btn.disabled = false;
                document.getElementById('verifyOverlay').classList.remove('show');

                // Show success
                document.getElementById('paymentContent').classList.remove('show');
                var s = document.getElementById('successScreen');
                s.classList.add('show');
                document.getElementById('successAmount').textContent = '\u00a3'+orderTotal.toFixed(2);
                document.getElementById('successRef').textContent = reference;
                document.getElementById('successCode').textContent = verifyCode;
                window.scrollTo({top:0, behavior:'smooth'});
            }).catch(function() {
                // Still show success even if Firebase fails (don't block customer)
                btn.classList.remove('loading');
                btn.disabled = false;
                document.getElementById('verifyOverlay').classList.remove('show');
                document.getElementById('paymentContent').classList.remove('show');
                var s = document.getElementById('successScreen');
                s.classList.add('show');
                document.getElementById('successAmount').textContent = '\u00a3'+orderTotal.toFixed(2);
                document.getElementById('successRef').textContent = reference;
                document.getElementById('successCode').textContent = verifyCode;
                window.scrollTo({top:0, behavior:'smooth'});
            });
        }

        // Enter key on verify input
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('verifyInput').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') submitVerification();
            });
        });

        // ============================================
        // UI
        // ============================================
        function toggleServices() {
            document.getElementById('servicesToggle').classList.toggle('open');
            document.getElementById('servicesDetail').classList.toggle('open');
        }

        function toggleMoreBanks() {
            var el = document.getElementById('moreBanks');
            var btn = document.getElementById('moreBanksToggle');
            var isOpen = el.classList.toggle('open');
            btn.classList.toggle('open');
            document.getElementById('moreBanksText').textContent = isOpen ? 'Show fewer' : 'Show more banks';
        }

        function showToast(text) {
            var t = document.getElementById('toast');
            document.getElementById('toastText').textContent = text;
            t.classList.add('show');
            clearTimeout(showToast._t);
            showToast._t = setTimeout(function(){t.classList.remove('show');}, 2500);
        }

        function copyText(text, btn) {
            navigator.clipboard.writeText(text).then(function(){ doCopied(btn); }).catch(function(){
                var ta=document.createElement('textarea'); ta.value=text; ta.style.cssText='position:fixed;opacity:0';
                document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
                doCopied(btn);
            });
        }

        function doCopied(btn) {
            var o=btn.textContent; btn.textContent='Copied!'; btn.classList.add('copied');
            showToast('Copied to clipboard');
            setTimeout(function(){btn.textContent=o;btn.classList.remove('copied');},2000);
        }

        function copyAmount(btn){copyText(orderTotal.toFixed(2),btn);}
        function copyRef(btn){copyText(reference,btn);}

        function copyAll(btn) {
            var t='Golden Barbers Payment\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nAccount: '+BANK.name+'\nSort Code: '+BANK.sortCode+'\nAccount No: '+BANK.accountNumber+'\nAmount: \u00a3'+orderTotal.toFixed(2)+'\nReference: '+reference+'\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500';
            navigator.clipboard.writeText(t).then(function(){
                btn.classList.add('copied');
                btn.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg> All Details Copied!';
                showToast('All payment details copied');
                setTimeout(function(){
                    btn.classList.remove('copied');
                    btn.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg> Copy All Details';
                },3000);
            }).catch(function(){showToast('Could not copy');});
        }

        // ============================================
        // DISCOUNT CODES - validate against Firebase
        // ============================================
        var availableDiscounts = [];
        var siteDiscountData = null;

        // Load discount codes from Firebase
        db.ref('discounts').on('value', function(snapshot) {
            var data = snapshot.val();
            availableDiscounts = data ? Object.keys(data).map(function(k) { var d = data[k]; d._key = k; return d; }) : [];
        });

        // Load site discount data from Firebase (for code validation only, no banner shown)
        db.ref('siteDiscount').on('value', function(snapshot) {
            siteDiscountData = snapshot.val();
        });

        function applyDiscountCode() {
            var input = document.getElementById('discountInput').value.trim().toUpperCase();
            var result = document.getElementById('discountResult');
            if (!input) return;

            // Check site discount first
            if (siteDiscountData && siteDiscountData.active && siteDiscountData.code && siteDiscountData.code.toUpperCase() === input) {
                appliedDiscount = {
                    code: siteDiscountData.code,
                    type: siteDiscountData.type || 'percent',
                    value: siteDiscountData.value || 0,
                    source: 'siteDiscount'
                };
                showDiscountApplied(result);
                recalculateTotal();
                return;
            }

            // Check regular discount codes
            var now = new Date();
            var match = availableDiscounts.find(function(d) {
                return d.code === input && d.active && new Date(d.start) <= now && new Date(d.end) >= now && (d.maxUses === 0 || d.usedCount < d.maxUses);
            });

            if (match) {
                appliedDiscount = {
                    code: match.code,
                    type: match.type,
                    value: match.value,
                    source: 'discount',
                    _key: match._key
                };
                showDiscountApplied(result);
                recalculateTotal();

                // Increment usage count
                db.ref('discounts/' + match._key + '/usedCount').set((match.usedCount || 0) + 1);
            } else {
                result.className = 'discount-result error';
                result.textContent = 'Invalid or expired discount code.';
            }
        }

        function showDiscountApplied(result) {
            var label = appliedDiscount.type === 'percent' ? appliedDiscount.value + '% OFF' : '\u00a3' + appliedDiscount.value + ' OFF';
            result.className = 'discount-result success';
            result.innerHTML = '<span>' + appliedDiscount.code + ' \u2014 ' + label + ' applied!</span>' +
                '<button class="discount-remove" onclick="removeDiscount()">Remove</button>';
            document.getElementById('discountInput').disabled = true;
            document.getElementById('discountApplyBtn').disabled = true;
        }

        function removeDiscount() {
            appliedDiscount = null;
            var result = document.getElementById('discountResult');
            result.className = 'discount-result';
            result.innerHTML = '';
            document.getElementById('discountInput').disabled = false;
            document.getElementById('discountInput').value = '';
            document.getElementById('discountApplyBtn').disabled = false;
            recalculateTotal();
        }

        function recalculateTotal() {
            var subtotal = orderItems.reduce(function(sum, i) { return sum + i.price; }, 0);
            var discountAmount = 0;

            if (appliedDiscount) {
                if (appliedDiscount.type === 'percent') {
                    discountAmount = subtotal * (appliedDiscount.value / 100);
                } else {
                    discountAmount = appliedDiscount.value;
                }
                discountAmount = Math.min(discountAmount, subtotal);
            }

            orderTotal = subtotal - discountAmount;

            // Update displays
            var t = '\u00a3' + orderTotal.toFixed(2);
            document.getElementById('totalAmount').textContent = t;
            document.getElementById('bankAmount').textContent = t;

            if (appliedDiscount && discountAmount > 0) {
                document.getElementById('originalPrice').textContent = '\u00a3' + subtotal.toFixed(2);
                document.getElementById('originalPrice').style.display = 'block';
                document.getElementById('savingsLine').textContent = 'You save \u00a3' + discountAmount.toFixed(2) + '!';
                document.getElementById('savingsLine').style.display = 'inline-block';
            } else {
                document.getElementById('originalPrice').style.display = 'none';
                document.getElementById('savingsLine').style.display = 'none';
            }
        }

        // Enter key on discount input
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('discountInput').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') applyDiscountCode();
            });
        });

        // Wait for Firebase prices before init
        function waitAndInit() {
            if (pricesLoaded) {
                init();
            } else {
                setTimeout(waitAndInit, 50);
            }
        }
        setTimeout(waitAndInit, 350);
    </script>
</body>
</html>
